<%= render "devise/shared/navbar" %>
<%= render "devise/shared/notice" %>
<div class="flex min-h-full items-center justify-center py-12 px-4 sm:px-6 lg:px-8" style="height:20rem; margin-bottom:5%;margin-top:5%">
  <div class="bg-white rounded-lg shadow-lg p-4" style="margin-left:0%">
    <h1 class="text-xl font-bold mb-4">Customer Details</h1>
    <div class="grid grid-cols-2 gap-6" >
      <div>
        <p class="font-medium text-sm mb-0">Email:</p>
        <p><%= @customer.email %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Contact:</p>
        <p><%= @customer.contact %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Address:</p>
        <p><%= @customer.address.street %></p>
      </div>
      
      <div>
        <p class="font-medium text-sm mb-1">City:</p>
        <p><%= @customer.address.city %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Pincode:</p>
        <p><%= @customer.address.zipcode %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Aadhra Card Details:</p>
        <p><%= @customer.document.aadhar_card %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Pancard:</p>
        <p><%= @customer.document.pancard %></p>
      </div>
    </div>
  </div>
  <div class="bg-white rounded-lg shadow-lg p-4" style="margin-left:18%">
    <h1 class="text-xl font-bold mb-4">Guarentor Details</h1>
    <div class="grid grid-cols-2 gap-6" >
    <%guarentor=Guarentor.find_by(customer_id: @customer.id)%>
    <%if guarentor.present? %>
      <div>
        <p class="font-medium text-sm mb-1">Email:</p>
        <p><%= guarentor.email %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Contact:</p>
        <p><%= guarentor.contact %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Name:</p>
        <p><%= guarentor.name %></p>
      </div>
      
      <div>
        <p class="font-medium text-sm mb-1">Address:</p>
        <p><%= guarentor.address.street %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">City:</p>
        <p><%= guarentor.address.city %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Pincode:</p>
        <p><%= guarentor.address.zipcode %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Aadhra Card Details:</p>
        <p><%= guarentor.document.aadhar_card %></p>
      </div>

      <div>
        <p class="font-medium text-sm mb-1">Pancard:</p>
        <p><%= guarentor.document.pancard %></p>
        <%else%>
        <h1>Please Click Below to add Guarentor<h1>
        <%= link_to 'Add Guarentor', new_customer_guarentor_path(customer_id: @customer.id), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
        <%end%>
      </div>
    </div>
  </div>
</div>

<section class="container px-4 mx-auto" style="height:auto; margin-bottom:5%;margin-top:5%">
  <div class="flex flex-col" >
    <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
      <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
        <div class="overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg">
          <header class="px-5 py-4 border-b border-gray-100">
            <h1 class="font-semibold text-gray-800">Loans </h1><small>No. of Loans :- <%= @loans.count %></small>
            <td><%= link_to 'New Loan', new_customer_loan_path(customer_id: @customer.id), class: 'bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-4 rounded', style: "margin-left: 62em;" %>
                </td>
          </header >
          <table class="table-auto w-full" style="text-align:center" >
            <thead class="bg-gray-50 dark:bg-gray-800" >
              <tr>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  S.NO.
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Loan Type
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Total Emi's
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Pending Emi's
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Rate of Interest
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Duration (in years)
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Total Amount with Interest
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Total Interest on Loan
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Principal Amount
                </th>
                
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Ending Date
                </th>
                <th scope="col" class="px-4 py-3.5 text-md font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400">
                  Closed at
                </th>
                
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-900">
              <%count=1%>
              <% @loans.each do |loan| %>
              <tr class="<%= loan.status == 'completed' ? 'green':''%>" 
              <tr class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap" style='height: 60px;'>  
                <td><%= count %></td>
                <% count=count+1 %>
                <td class="text-indigo-500"><%=link_to loan.loan_type.capitalize, customer_loan_emis_path(loan_id: loan.id, customer_id: @customer.id) %> loan</td>
                <% loan.id%>
                <td><%= loan.number_emis %></td>
                <td><%=loan.pending_emi%></td>
                <td><%= loan.roi %>%</td>
                <td><%= loan.duration_year %> years</td>
                <td>Rs. <%= loan.total_payment.round(2) %></td>
                <td>Rs. <%= loan.total_interest.round(2) %></td>
                <td>Rs. <%= loan.amount %></td>
                <td><%= loan.end_at %></td>
                <td><%= loan&.closed_at %></td>
              </tr>
              </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<%= render "devise/shared/footer" %>


